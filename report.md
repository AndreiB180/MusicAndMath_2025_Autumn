# 实验报告：基于遗传算法的机器作曲

## 1. 引言
本实验旨在探索利用遗传算法（Genetic Algorithm, GA）自动生成具有一定音乐性的旋律片段。通过模拟生物进化过程中的选择、交叉和变异机制，我们尝试让计算机在预设的音乐规则指导下，从随机噪声中“进化”出符合人类听觉习惯的音乐。

## 2. 算法设计与实现

### 2.1 编码方案
我们将一段 4/4 拍、长度为 4 小节的旋律编码为一个整数序列。
- **基因 (Gene)**：每个整数代表一个八分音符的音高或休止符。
- **染色体 (Chromosome)**：长度为 32 的整数列表（4 小节 × 8 个八分音符）。
- **音域映射**：使用整数 1-27 映射 F3 到 G5 的三个八度音域，0 代表休止符，28 代表延音。

### 2.2 初始种群
实验采用了**随机生成**策略。我们在给定的乐音体系 S 中随机选取音级，生成了 100 个初始个体。虽然初始旋律杂乱无章，但它们包含了丰富的基因多样性，为后续进化提供了基础。

### 2.3 遗传操作
为了丰富种群的多样性并保留优良特征，我们实现了以下算子：
- **交叉 (Crossover)**：单点交叉，模拟父母基因的重组。
- **变异 (Mutation)**：随机改变某个位置的音符，引入新的遗传特征。
- **音乐变换算子**：
    - **移调 (Transposition)**：整体升降调。
    - **倒影 (Inversion)**：以中心音为轴进行镜像变换。
    - **逆行 (Retrograde)**：将旋律时间轴反转。

### 2.4 适应度函数 (Fitness Function)
适应度函数是指导进化的核心。本实验对比了三种不同的适应度评价策略：

1.  **基于乐理规则 (Rule-based)**：
    - 奖励落在 C 大调音阶内的音符（调性稳定性）。
    - 奖励级进和小跳，惩罚八度以上的大跳（旋律流畅性）。
    - 奖励结束在主音或属音的旋律（终止式完整性）。
    
2.  **基于统计规律 (Statistical)**：
    - 利用中心极限定理，引导旋律的平均音高回归到人声舒适区（如中央 C 附近）。
    - 这种方法生成的旋律听起来更“平稳”，但可能缺乏结构感。

3.  **基于马尔可夫链 (Markov Chain)**：
    - 构建了一个简化的二元转移概率矩阵，认为“级进”概率最高，“大跳”概率最低。
    - 计算旋律的平均对数似然度，似然度越高，说明旋律越符合统计学上的“好听”规律。

## 3. 实验结果与分析

### 3.1 进化过程观测
在 100 代的进化过程中，我们观察到：
- **初期 (1-20代)**：适应度增长迅速，杂乱的随机音符逐渐被调内音符取代，听感上的“离调感”显著降低。
- **中期 (20-60代)**：适应度增长放缓，算法开始优化音程关系，大跳减少，旋律线条变得流畅。
- **后期 (60-100代)**：种群趋于稳定，最优个体在局部进行微调。

### 3.2 适应度函数的影响
- **乐理规则函数**生成的旋律结构最严谨，调性明确，但有时显得刻板。
- **马尔可夫函数**生成的旋律流畅度极高，像是一条连绵不断的线，但缺乏明确的乐句起伏。
- **统计函数**生成的旋律则较为中庸，音高分布集中，但缺乏音乐动机。

### 3.3 算法效率
- 较大的种群规模 (N=200) 和较高的变异率 (P=0.4) 有效防止了算法早熟收敛。
- 引入移调、倒影等音乐算子显著扩大了搜索空间，使算法能跳出局部最优解。

## 4. 结论
实验表明，遗传算法能够有效地从随机序列中演化出具有一定音乐性的旋律。适应度函数的设计是决定生成质量的关键：**显式的乐理规则能保证旋律的“正确性”，而隐式的统计规律则能提升旋律的“自然度”**。未来的工作可以尝试结合深度学习模型（如 LSTM 或 Transformer）作为适应度评估器，以捕捉更深层次的音乐结构。
